// This file is automatically generated by Teams Toolkit.
// The teamsfx tasks defined in this file require Teams Toolkit version >= 5.0.0.
// See https://aka.ms/teamsfx-tasks for details on how to customize each task.
{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Start Teams App Locally",
      "dependsOn": [
        "Validate prerequisites",
        "Provision",
        "Deploy",
        "Start application"
      ],
      "dependsOrder": "sequence"
    },
    {
      "label": "Validate prerequisites",
      "type": "teamsfx",
      "command": "debug-check-prerequisites",
      "args": {
        "prerequisites": ["nodejs", "m365Account", "portOccupancy"],
        "portOccupancy": [53000, 7071, 9229]
      }
    },
    {
      "label": "Provision",
      "type": "teamsfx",
      "command": "provision",
      "args": {
        "env": "local"
      }
    },
    {
      "label": "Deploy",
      "type": "teamsfx",
      "command": "deploy",
      "args": {
        "env": "local"
      }
    },
    {
      "label": "Start application",
      "dependsOn": ["Start frontend", "Start backend", "Run m365 proxy"]
    },
    {
      "label": "Start frontend",
      "type": "shell",
      "command": "npm run dev:teamsfx",
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "problemMatcher": {
        "pattern": {
          "regexp": "^.*$",
          "file": 0,
          "location": 1,
          "message": 2
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": ".*",
          "endsPattern": "Compiled|Failed|compiled|failed"
        }
      }
    },
    {
      "label": "Start backend",
      "type": "shell",
      "command": "npm run dev:teamsfx",
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/api",
        "env": {
          "PATH": "${workspaceFolder}/devTools/func:${env:PATH}"
        }
      },
      "windows": {
        "options": {
          "env": {
            "PATH": "${workspaceFolder}/devTools/func;${env:PATH}"
          }
        }
      },
      "problemMatcher": {
        "pattern": {
          "regexp": "^.*$",
          "file": 0,
          "location": 1,
          "message": 2
        },
        "background": {
          "activeOnStart": true,
          "beginsPattern": "^.*(Job host stopped|signaling restart).*$",
          "endsPattern": "^.*(Worker process started and initialized|Host lock lease acquired by instance ID).*$"
        }
      },
      "presentation": {
        "reveal": "silent"
      },
      "dependsOn": "Watch backend"
    },
    {
      "label": "Watch backend",
      "type": "shell",
      "command": "npm run watch:teamsfx",
      "isBackground": true,
      "options": {
        "cwd": "${workspaceFolder}/api"
      },
      "problemMatcher": "$tsc-watch",
      "presentation": {
        "reveal": "silent"
      }
    },
    {
      "label": "Run m365 proxy",
      "type": "process",
      "command": "m365proxy",
      "isBackground": true,
      "args": [
        "-f",
        "0",
        "--mocks-file",
        "responses.sample.json",
        "--watch-process-names",
        "node",
        "--watch-process-names",
        "msedge",
        "--record",
        "--minimal-permissions-summary-file-path",
        "permission.json"
      ],
      "options": {
        "cwd": "${workspaceFolder}/m365proxy"
      },
      "presentation": {
        "reveal": "silent"
      },
      "problemMatcher": [
        {
          "pattern": {
            "regexp": "^.*$",
            "file": 1,
            "line": 1,
            "column": 1,
            "message": 1
          },
          "background": {
            "activeOnStart": true,
            "beginsPattern": ".*",
            "endsPattern": "^.*(Recording...).*$"
          }
        }
      ]
    }
    // {
    // "label": "Run m365 proxy",
    // "type": "shell",
    // "command": "npm run m",
    // "isBackground": true,
    // "presentation": {
    //     "reveal": "silent"
    // },
    // "problemMatcher": "$tsc-watch",

    // "problemMatcher": [
    //     {
    //         "pattern": {
    //             "regexp": "^.*$",
    //             "file": 0,
    //             "location": 1,
    //             "message": 2
    //         },
    //         "background": {
    //             "activeOnStart": true,
    //             "beginsPattern": ".*",
    //             "endsPattern": "Compiled|Failed|compiled|failed"
    //         }
    //       }
    //   ]
    // }
  ]
}
